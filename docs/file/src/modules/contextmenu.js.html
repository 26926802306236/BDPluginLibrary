<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/modules/contextmenu.js | pluginlibrary</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Zere&apos;s library for BetterDiscord plugins."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="pluginlibrary"><meta property="twitter:description" content="Zere&apos;s library for BetterDiscord plugins."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules">modules</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/colorconverter.js~ColorConverter.html">ColorConverter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~ImageItem.html">ImageItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~ItemGroup.html">ItemGroup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~Menu.html">Menu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~MenuItem.html">MenuItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~SubMenuItem.html">SubMenuItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~TextItem.html">TextItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/contextmenu.js~ToggleItem.html">ToggleItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/discordapi.js~DiscordAPI.html">DiscordAPI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/domhelpers.js~ClassName.html">ClassName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/domhelpers.js~DOMHelpers.html">DOMHelpers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/domhelpers.js~Selector.html">Selector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/patcher.js~Patcher.html">Patcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/permissions.js~DiscordPermissions.html">DiscordPermissions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~ColorPicker.html">ColorPicker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~ControlGroup.html">ControlGroup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~PillButton.html">PillButton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~Slider.html">Slider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~Switch.html">Switch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/pluginsettings.js~Textbox.html">Textbox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/reacttools.js~ReactTools.html">ReactTools</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/tooltips.js~NativeTooltip.html">NativeTooltip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/tooltips.js~PluginTooltip.html">PluginTooltip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/utilities.js~Utilities.html">Utilities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/webpackmodules.js~Filters.html">Filters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/webpackmodules.js~WebpackModules.html">WebpackModules</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DiscordClasses">DiscordClasses</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DiscordSelectors">DiscordSelectors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PluginUpdateUtilities">PluginUpdateUtilities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PluginUtilities">PluginUtilities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LogTypes">LogTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-css">css</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#structs-settings">structs/settings</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structs/settings/setting.js~SettingField.html">SettingField</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#vendor">vendor</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$">$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jQuery">jQuery</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/modules/contextmenu.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Self-made context menus that emulate Discord&apos;s own context menus.
 * @module PluginContextMenu
 * @version 0.0.7
 */

import {DiscordClasses, DiscordSelectors} from &quot;./DiscordClassModules&quot;;
import {$} from &quot;../vendor&quot;;


/** Main menu class for creating custom context menus. */
export class Menu {
    /**
     * 
     * @param {boolean} [scroll=false] - should this menu be a scrolling menu (usually only used for submenus)
     */
	constructor(scroll = false) {
		this.theme = $(&apos;.theme-dark&apos;).length ? &quot;theme-dark&quot; : &quot;theme-light&quot;;
		this.element = $(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.contextMenu).addClass(&quot;plugin-context-menu&quot;).addClass(this.theme);
		this.scroll = scroll;
		if (scroll) {
			this.scroller = $(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ScrollerClasses.scroller).addClass(DiscordClasses.ContextMenuClasses.scroller);
			this.element.append($(&quot;&lt;div&gt;&quot;)
				.addClass(DiscordClasses.ScrollerClasses.scrollerWrap)
				.addClass(DiscordClasses.ScrollerClasses.scrollerThemed)
				.addClass(DiscordClasses.ScrollerClasses.themeGhostHairline).append(
					this.scroller
			));
		}
	}
    
    /**
     * Adds an item group to the menu. The group should already be populated.
     * @param {PluginContextMenu.ItemGroup} contextGroup - group to add to the menu
     * @returns {PluginContextMenu.Menu} returns self for chaining
     */
	addGroup(contextGroup) {
		if (this.scroll) this.scroller.append(contextGroup.getElement());
		else this.element.append(contextGroup.getElement());
		return this;
	}
    
    /**
     * Adds items to the context menu directly. It is recommended to add to a group and use 
     * {@link PluginContextMenu.Menu#addGroup} instead to behave as natively as possible.
     * @param {PluginContextMenu.MenuItem} contextItems - list of items to add to the context menu
     * @returns {PluginContextMenu.Menu} returns self for chaining
     */
	addItems(...contextItems) {
		for (var i = 0; i &lt; contextItems.length; i++) {
			if (this.scroll) this.scroller.append(contextItems[i].getElement());
			else this.element.append(contextItems[i].getElement());
		}
		return this;
	}
    
    /**
     * Shows the menu at a specific x and y position. This generally comes from the
     * pointer position on a right click event.
     * @param {number} x - x coordinate for the menu to show at
     * @param {number} y - y coordinate for the menu to show at
     */
	show(x, y) {
		const maxWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
		const maxHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
		const mouseX = x;
		const mouseY = y;
		
		let type = this.element.parents(&quot;.plugin-context-menu&quot;).length &gt; this.element.parents(DiscordSelectors.ContextMenuClasses.contextMenu).length ? &quot;.plugin-context-menu&quot; : DiscordSelectors.ContextMenuClasses.contextMenu;
		var depth = this.element.parents(type).length;
		if (depth == 0) this.element.appendTo(&apos;#app-mount&apos;);
		this.element.css(&quot;top&quot;, mouseY).css(&quot;left&quot;, mouseX);
		
		if (depth &gt; 0) {
			var top = this.element.parents(type).last();
			var closest = this.element.parents(type).first();
			var negate = closest.hasClass(DiscordClasses.ContextMenuClasses.invertChildX) ? -1 : 1;
			this.element.css(&quot;margin-left&quot;, negate * closest.find(`.${DiscordClasses.ContextMenuClasses.item}`).outerWidth() + closest.offset().left - top.offset().left);
		}
		
		if (mouseY + this.element.outerHeight() &gt;= maxHeight) {
			this.element.addClass(&quot;invertY&quot;).addClass(DiscordClasses.ContextMenuClasses.invertY);
			this.element.css(&quot;top&quot;, mouseY - this.element.outerHeight());
			if (depth &gt; 0) this.element.css(&quot;top&quot;, (mouseY + this.element.parent().outerHeight()) - this.element.outerHeight());
		}
		if (this.element.offset().left + this.element.outerWidth() &gt;= maxWidth) {
			this.element.addClass(&quot;invertX&quot;);
			this.element.css(&quot;left&quot;, mouseX - this.element.outerWidth());
		}
		if (this.element.offset().left + 2 * this.element.outerWidth() &gt;= maxWidth) {
			this.element.addClass(DiscordClasses.ContextMenuClasses.invertChildX);
		}

		if (depth == 0) {
			$(document).on(&quot;mousedown.zctx&quot;, (e) =&gt; {
				if (!this.element.has(e.target).length &amp;&amp; !this.element.is(e.target)) {
					this.removeMenu();
				}
			});
			$(document).on(&quot;click.zctx&quot;, (e) =&gt; {
				if (this.element.has(e.target).length) {
					if ($._data($(e.target).closest(DiscordSelectors.ContextMenuClasses.item)[0], &apos;events&apos;).click) {
						this.removeMenu();
					}
				}
			});
			$(document).on(&quot;keyup.zctx&quot;, (e) =&gt; {
				if (e.keyCode === 27) {
					this.removeMenu();
				}
			});
		}
	}
    
    /** Allows you to remove the menu. */
	removeMenu() {
		let type = this.element.parents(&quot;.plugin-context-menu&quot;).length &gt; this.element.parents(DiscordSelectors.ContextMenuClasses.contextMenu).length ? &quot;.plugin-context-menu&quot; : DiscordSelectors.ContextMenuClasses.contextMenu;
		this.element.detach();
		this.element.find(type).detach();
		$(document).off(&quot;.zctx&quot;);
	}
    
    /**
     * Used to attach a menu to a menu item. This is how to create a submenu.
     * If using {@link PluginContextMenu.SubMenuItem} then you do not need
     * to call this function as it is done automatically. If you want to attach
     * a submenu to an existing Discord context menu, then you should use this
     * method.
     * @param {(HTMLElement|jQuery)} menuItem - item to attach to
     */
	attachTo(menuItem) {
		this.menuItem = $(menuItem);
		menuItem.on(&quot;mouseenter&quot;, () =&gt; {
			this.element.appendTo(menuItem);
			let type = this.element.parents(&quot;.plugin-context-menu&quot;).length &gt; this.element.parents(DiscordSelectors.ContextMenuClasses.contextMenu).length ? &quot;.plugin-context-menu&quot; : DiscordSelectors.ContextMenuClasses.contextMenu;
			this.show(this.element.parents(type).css(&quot;left&quot;), menuItem.offset().top);
		});
		menuItem.on(&quot;mouseleave&quot;, () =&gt; { this.element.detach(); });
	}
}

/** Class that represents a group of menu items. */
export class ItemGroup {
    /** Creates an item group. */
	constructor() {
		this.element = $(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.itemGroup);
	}
    
    /**
     * This is the method of adding menu items to a menu group.
     * @param {PluginContextMenu.MenuItem} contextItems - list of context menu items to add to this group
     * @returns {PluginContextMenu.ItemGroup} returns self for chaining
     */
	addItems(...contextItems) {
		for (var i = 0; i &lt; contextItems.length; i++) {
			this.element.append(contextItems[i].getElement());
		}
		return this;
	}
    
    /** @returns {HTMLElement} returns the DOM node for the group */
	getElement() { return this.element; }
}

/**
 * Fires when the attached menu item it clicked.
 * @param {MouseEvent} event - the mouse event from clicking the item
 * @callback PluginContextMenu~clickEvent
 */

 /**
 * Fires when the checkbox item changes state.
 * @param {boolean} isChecked - if the checkbox is now checked
 * @callback PluginContextMenu~onChange
 */

/** Base class for all other menu items. */
export class MenuItem {
    /**
     * @param {string} label - label to show on the menu item
     * @param {object} options - additional options for the item
     * @param {boolean} [options.danger=false] - should the item show as danger
     * @param {PluginContextMenu~clickEvent} [options.callback] - callback for when it is clicked
     */
	constructor(label, options = {}) {
		var {danger = false, callback} = options;
		this.element = $(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.item);
		this.label = label;
		if (danger) this.element.addClass(DiscordClasses.ContextMenuClasses.danger);
		if (typeof(callback) == &apos;function&apos;) {
			this.element.on(&quot;click&quot;, (event) =&gt; {
				event.stopPropagation();
				callback(event);
			});
		}
	}
	getElement() { return this.element;}
}

/** 
 * Creates a text menu item that can have a hint.
 * @extends MenuItem
 */
export class TextItem extends MenuItem {
    /**
     * @param {string} label - label to show on the menu item
     * @param {object} options - additional options for the item
     * @param {string} [options.hint=&quot;&quot;] - hint to show on the item (usually used for key combos)
     * @param {boolean} [options.danger=false] - should the item show as danger
     * @param {PluginContextMenu~clickEvent} [options.callback] - callback for when it is clicked
     */
	constructor(label, options = {}) {
		super(label, options);
		var {hint = &quot;&quot;} = options;
		this.element.append($(&quot;&lt;span&gt;&quot;).text(label));
		this.element.append($(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.hint).text(hint));
	}
}

/** 
 * Creates an image menu item that can have an image.
 * @extends MenuItem
 */
export class ImageItem extends MenuItem {
    /**
     * @param {string} label - label to show on the menu item
     * @param {string} imageSrc - link to the image to embed
     * @param {object} options - additional options for the item
     * @param {string} [options.hint=&quot;&quot;] - hint to show on the item (usually used for key combos)
     * @param {boolean} [options.danger=false] - should the item show as danger
     * @param {PluginContextMenu~clickEvent} [options.callback] - callback for when it is clicked
     */
	constructor(label, imageSrc, options = {}) {
		super(label, options);
		this.element.addClass(DiscordClasses.ContextMenuClasses.itemImage);
		this.element.append($(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.label).text(label));
		this.element.append($(&quot;&lt;img&gt;&quot;, {src: imageSrc}));
	}
}

/** 
 * Creates a menu item with an attached submenu.
 * @extends .MenuItem
 */
export class SubMenuItem extends MenuItem {
    /**
     * @param {string} label - label to show on the menu item
     * @param {PluginContextMenu.Menu} subMenu - context menu that should be attached to this item
     * @param {object} options - additional options for the item
     * @param {string} [options.hint=&quot;&quot;] - hint to show on the item (usually used for key combos)
     * @param {boolean} [options.danger=false] - should the item show as danger
     * @param {PluginContextMenu~clickEvent} [options.callback] - callback for when it is clicked
     */
	constructor(label, subMenu, options = {}) {
		// if (!(subMenu instanceof ContextSubMenu)) throw &quot;subMenu must be of ContextSubMenu type.&quot;;
		super(label, options);
		this.element.addClass(DiscordClasses.ContextMenuClasses.itemSubMenu).text(label);
		this.subMenu = subMenu;
		this.subMenu.attachTo(this.getElement());
	}
}

/** 
 * Creates a menu item with a checkbox.
 * @extends MenuItem
 */
export class ToggleItem extends MenuItem {
    /**
     * @param {string} label - label to show on the menu item
     * @param {boolean} checked - should the item start out checked
     * @param {object} options - additional options for the item
     * @param {string} [options.hint=&quot;&quot;] - hint to show on the item (usually used for key combos)
     * @param {boolean} [options.danger=false] - should the item show as danger
     * @param {PluginContextMenu~clickEvent} [options.callback] - callback for when it is clicked
     * @param {PluginContextMenu~onChange} [options.onChange] - callback for when the checkbox changes
     */
	constructor(label, checked, options = {}) {
        var {onChange} = options;
		super(label, options);
		this.element.addClass(DiscordClasses.ContextMenuClasses.itemToggle);
        this.element.append($(&quot;&lt;div&gt;&quot;).addClass(DiscordClasses.ContextMenuClasses.label).text(label));
        this.checkbox = $(&quot;&lt;div&gt;&quot;, {class: &quot;checkbox&quot;});
        this.checkbox.append($(&quot;&lt;div&gt;&quot;, {class: &quot;checkbox-inner&quot;}));
        this.checkbox.append(&quot;&lt;span&gt;&quot;);
        this.input = $(&quot;&lt;input&gt;&quot;, {type: &quot;checkbox&quot;, checked: checked, value: &quot;on&quot;});
        this.checkbox.find(&apos;.checkbox-inner&apos;).append(this.input).append(&quot;&lt;span&gt;&quot;);
        this.element.append(this.checkbox);
        this.element.on(&apos;click&apos;, (e) =&gt; {
            e.stopPropagation();
            this.input.prop(&quot;checked&quot;, !this.input.prop(&quot;checked&quot;));
            if (typeof(onChange) == &apos;function&apos;) onChange(this.input.prop(&quot;checked&quot;));
        });
	}
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
